# Node.js Package Management with node2nix

This directory contains declarative npm package definitions generated by node2nix.

## Files

- `node-packages.json` - Input file listing npm packages to install
- `default.nix` - Generated by node2nix (do not edit)
- `node-env.nix` - Generated by node2nix (do not edit)
- `node-packages.nix` - Generated by node2nix (do not edit)

## Adding/Updating Packages

1. Edit `node-packages.json` to add/remove/update packages:
   ```json
   [
     { "@anthropic-ai/claude-code": "2.0.5" },
     { "some-other-package": "1.0.0" }
   ]
   ```

2. Regenerate the Nix files:
   ```bash
   cd modules/node
   node2nix -i node-packages.json
   ```

3. Rebuild your system:
   ```bash
   ./rebuild.sh
   ```

## Usage in Configuration

The packages are imported directly in user configurations (e.g., `modules/common/home/claby2.nix`):

```nix
let
  # Import node packages generated by node2nix
  node2nixPackages = import ../../node/default.nix {
    inherit pkgs;
    inherit (pkgs.stdenv.hostPlatform) system;
    nodejs = pkgs.nodejs;
  };

  # Extract specific packages into variables
  claudeCode = node2nixPackages."@anthropic-ai/claude-code-2.0.5";
in {
  home.packages = [
    claudeCode
    # other packages...
  ];
}
```

**Note**: Packages must be extracted into variables in the `let` block rather than accessed directly in the packages list to avoid type errors.